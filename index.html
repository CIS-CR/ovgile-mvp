<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SOLICITUD DE MANTENIMIENTO / SERVICIO – MVP</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Extra mínimo para la verificación del vehículo (sin romper tu style.css) */
    .vehicle-preview{
      margin-top: 10px;
      padding: 12px;
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 12px;
      background: rgba(0,0,0,.02);
      display: none;
    }
    .vehicle-preview h3{
      margin: 0 0 10px 0;
      font-size: 14px;
      opacity: .8;
    }
    .vehicle-grid{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .readonly-field label{
      display:block;
      font-size: 12px;
      opacity: .75;
      margin-bottom: 4px;
    }
    .readonly-field input{
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 10px;
      background: #f7f7f7;
    }
    @media(min-width: 560px){
      .vehicle-grid{ grid-template-columns: 1fr 1fr; }
    }
    .hint{
      font-size: 12px;
      opacity: .7;
      margin-top: 6px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>SOLICITUD DE MANTENIMIENTO / SERVICIO</h1>
    <p class="subtitle">Envía tu solicitud y la registraremos como un ticket de soporte.</p>

    <!-- IMPORTANTE: mantenemos id="surfForm" y el layout base que ya te funciona -->
    <form id="surfForm">

      <h2>1. Información del solicitante</h2>
      <input type="text" name="nombre" placeholder="Nombre completo" required />
      <input type="email" name="email" placeholder="Correo electrónico" required />

      <!-- Esto ya existe en tu versión funcional y tu app.js lo elimina si viene vacío -->
      <label>Ubicación (opcional)</label>
      <select name="location">
        <option value="">Seleccionar ubicación</option>
        <option>Granja 1</option>
        <option>Granja 2</option>
        <option>Oficina</option>
        <option>Matadero</option>
      </select>

      <h2>2. Vehículo (Flota)</h2>

      <label>Seleccionar vehículo</label>
      <select id="vehiculo_id" name="vehiculo_id" required>
        <option value="">Seleccionar</option>
      </select>
      <p class="hint">Al seleccionar el vehículo, se asociará automáticamente su centro de costo.</p>

      <!-- Vista visible para validar -->
      <div id="vehiclePreview" class="vehicle-preview" aria-live="polite">
        <h3>Datos del vehículo (verificación)</h3>
        <div class="vehicle-grid">
          <div class="readonly-field">
            <label>Placa</label>
            <input type="text" id="placa_view" readonly />
          </div>
          <div class="readonly-field">
            <label>Marca</label>
            <input type="text" id="marca_view" readonly />
          </div>
          <div class="readonly-field">
            <label>Modelo</label>
            <input type="text" id="modelo_view" readonly />
          </div>
          <div class="readonly-field">
            <label>Color</label>
            <input type="text" id="color_view" readonly />
          </div>
          <div class="readonly-field">
            <label>Año</label>
            <input type="text" id="anio_view" readonly />
          </div>
          <div class="readonly-field">
            <label>Centro de costo</label>
            <input type="text" id="centro_costo_view" readonly />
          </div>
        </div>
      </div>

      <!-- Snapshot oculto (se envía al endpoint como el resto de campos) -->
      <input type="hidden" id="placa" name="placa" />
      <input type="hidden" id="marca" name="marca" />
      <input type="hidden" id="modelo" name="modelo" />
      <input type="hidden" id="color" name="color" />
      <input type="hidden" id="anio" name="anio" />
      <input type="hidden" id="vin_serial" name="vin_serial" />
      <input type="hidden" id="centro_costo_id" name="centro_costo_id" />
      <input type="hidden" id="centro_costo_nombre" name="centro_costo_nombre" />

      <h2>3. Clasificación</h2>

      <!-- Mantengo este campo porque tu backend/worker puede esperarlo.
           Lo dejamos fijo a "Incidencia" pero visible si quieres (puedes ocultarlo luego). -->
      <label>Tipo de solicitud</label>
      <select name="tipo_solicitud" required>
        <option value="">Seleccionar</option>
        <option selected>Incidencia</option>
        <option>Solicitud de servicio</option>
        <option>Consulta</option>
        <option>Emergencia</option>
      </select>

      <label>Categoría</label>
      <select id="categoria" name="categoria" required>
        <option value="">Seleccionar</option>
        <option>Aire acondicionado</option>
        <option>Electricidad</option>
        <option>Mecánica</option>
        <option>Frenos</option>
        <option>Neumáticos</option>
        <option>Seguridad</option>
        <option>Otros</option>
      </select>

      <!-- Mantengo el nombre "prioridad" porque tu versión funcional lo envía así.
           Lo renombramos en UI a urgencia, pero el field sigue siendo "prioridad". -->
      <label>Nivel de urgencia</label>
      <select id="prioridad" name="prioridad" required>
        <option value="">Seleccionar</option>
        <option>Media</option>
        <option>Alta</option>
        <option>Crítica</option>
        <option>Baja</option>
      </select>

      <h2>4. Detalle</h2>

      <!-- Mantengo "asunto" porque tu versión funcional lo envía y es probable que el Worker lo use.
           Lo autogeneramos en JS para que sea consistente (editable por si acaso). -->
      <input
        type="text"
        id="asunto"
        name="asunto"
        placeholder="Asunto (resumen corto)"
        maxlength="120"
        required
      />

      <textarea
        name="descripcion"
        placeholder="Describe el problema. Incluye desde cuándo ocurre y cualquier detalle útil."
        required
      ></textarea>

      <div class="checkboxes">
        <label>
          <!-- Se mantiene para que el usuario confirme; tu app.js lo borra antes de enviar -->
          <input type="checkbox" name="confirmacion" value="true" required />
          Confirmo que la información proporcionada es correcta
        </label>
      </div>

      <button type="submit">Enviar solicitud</button>
    </form>

    <p id="statusMsg"></p>
  </div>

  <script>
    // ====== Base de datos ejemplo (Flota) – 10 vehículos ======
    var VEHICULOS = [
      { vehiculo_id:"VH-0001", placa:"FB-1023", marca:"Toyota", modelo:"Hilux", anio:2021, color:"Blanco", vin_serial:"JTEBX3FJ5M1234567", centro_costo_id:"CC-1001", centro_costo_nombre:"Flota - Hilux 2021 (FB-1023)", estado:"Activo" },
      { vehiculo_id:"VH-0002", placa:"FB-1048", marca:"Toyota", modelo:"Hiace", anio:2020, color:"Plata",  vin_serial:"JTFHX02P0L2345678", centro_costo_id:"CC-1002", centro_costo_nombre:"Flota - Hiace 2020 (FB-1048)", estado:"Activo" },
      { vehiculo_id:"VH-0003", placa:"FB-1102", marca:"Nissan", modelo:"Navara", anio:2019, color:"Gris",  vin_serial:"JN1BD7N23K3456789", centro_costo_id:"CC-1003", centro_costo_nombre:"Flota - Navara 2019 (FB-1102)", estado:"Activo" },
      { vehiculo_id:"VH-0004", placa:"FB-1157", marca:"Mitsubishi", modelo:"L200", anio:2022, color:"Negro", vin_serial:"MMBJNKB10N4567890", centro_costo_id:"CC-1004", centro_costo_nombre:"Flota - L200 2022 (FB-1157)", estado:"Activo" },
      { vehiculo_id:"VH-0005", placa:"FB-1209", marca:"Ford", modelo:"Ranger", anio:2018, color:"Azul",   vin_serial:"1FTER4FH8J5678901", centro_costo_id:"CC-1005", centro_costo_nombre:"Flota - Ranger 2018 (FB-1209)", estado:"Activo" },
      { vehiculo_id:"VH-0006", placa:"FB-1284", marca:"Chevrolet", modelo:"D-Max", anio:2020, color:"Rojo", vin_serial:"MPATFS85HJ6789012", centro_costo_id:"CC-1006", centro_costo_nombre:"Flota - D-Max 2020 (FB-1284)", estado:"Activo" },
      { vehiculo_id:"VH-0007", placa:"FB-1331", marca:"Hyundai", modelo:"H-1", anio:2017, color:"Blanco", vin_serial:"KMHWH81K0HU7890123", centro_costo_id:"CC-1007", centro_costo_nombre:"Flota - H-1 2017 (FB-1331)", estado:"Activo" },
      { vehiculo_id:"VH-0008", placa:"FB-1406", marca:"Kia", modelo:"Bongo", anio:2019, color:"Gris",    vin_serial:"KNCMB7A1XK8901234", centro_costo_id:"CC-1008", centro_costo_nombre:"Flota - Bongo 2019 (FB-1406)", estado:"Activo" },
      { vehiculo_id:"VH-0009", placa:"FB-1490", marca:"Suzuki", modelo:"Vitara", anio:2021, color:"Verde", vin_serial:"TSMLYD21SMM9012345", centro_costo_id:"CC-1009", centro_costo_nombre:"Flota - Vitara 2021 (FB-1490)", estado:"Activo" },
      { vehiculo_id:"VH-0010", placa:"FB-1555", marca:"Isuzu", modelo:"NPR", anio:2016, color:"Blanco",   vin_serial:"JALC4W161G0123456", centro_costo_id:"CC-1010", centro_costo_nombre:"Flota - NPR 2016 (FB-1555)", estado:"Activo" }
    ];

    var vehiculoSelect = document.getElementById("vehiculo_id");
    var preview = document.getElementById("vehiclePreview");
    var asuntoInput = document.getElementById("asunto");
    var categoriaSelect = document.getElementById("categoria");

    function optionLabel(v){
      return v.placa + " — " + v.marca + " " + v.modelo + " (" + v.centro_costo_id + ")";
    }

    // Poblar dropdown
    for (var i=0; i<VEHICULOS.length; i++){
      var v = VEHICULOS[i];
      if (v.estado !== "Activo") continue;
      var opt = document.createElement("option");
      opt.value = v.vehiculo_id;
      opt.textContent = optionLabel(v);
      vehiculoSelect.appendChild(opt);
    }

    function setVehicleSnapshot(v){
      // Hidden (se envía)
      document.getElementById("placa").value = v ? v.placa : "";
      document.getElementById("marca").value = v ? v.marca : "";
      document.getElementById("modelo").value = v ? v.modelo : "";
      document.getElementById("color").value = v ? v.color : "";
      document.getElementById("anio").value = v ? String(v.anio) : "";
      document.getElementById("vin_serial").value = v ? v.vin_serial : "";
      document.getElementById("centro_costo_id").value = v ? v.centro_costo_id : "";
      document.getElementById("centro_costo_nombre").value = v ? v.centro_costo_nombre : "";

      // Visible (verificación)
      document.getElementById("placa_view").value = v ? v.placa : "";
      document.getElementById("marca_view").value = v ? v.marca : "";
      document.getElementById("modelo_view").value = v ? v.modelo : "";
      document.getElementById("color_view").value = v ? v.color : "";
      document.getElementById("anio_view").value = v ? String(v.anio) : "";
      document.getElementById("centro_costo_view").value = v ? (v.centro_costo_id + " — " + v.centro_costo_nombre) : "";

      preview.style.display = v ? "block" : "none";
      buildAsunto();
    }

    function getSelectedVehiculo(){
      var id = vehiculoSelect.value;
      for (var i=0; i<VEHICULOS.length; i++){
        if (VEHICULOS[i].vehiculo_id === id) return VEHICULOS[i];
      }
      return null;
    }

    function buildAsunto(){
      var v = getSelectedVehiculo();
      var cat = categoriaSelect.value || "";
      if (!v && !cat) return;

      // Formato corto y consistente para Trello/FBOS
      var parts = [];
      if (v) parts.push(v.placa + " " + v.marca + " " + v.modelo);
      if (cat) parts.push(cat);
      asuntoInput.value = parts.join(" — ").slice(0, 120);
    }

    vehiculoSelect.addEventListener("change", function(e){
      var v = getSelectedVehiculo();
      setVehicleSnapshot(v);
    });

    categoriaSelect.addEventListener("change", function(){
      buildAsunto();
    });
  </script>

  <!-- Tu app.js actual (SIN CAMBIOS) -->
  <script src="app.js"></script>
</body>
</html>







